name: Qualit√© du code

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  lint:
    name: Linting (Ruff)
    runs-on: ubuntu-latest

    steps:
    - name: Checkout du code
      uses: actions/checkout@v4

    - name: Configuration de Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'

    - name: Installation de Ruff
      run: |
        python -m pip install --upgrade pip
        pip install ruff

    - name: Lancer Ruff (linting)
      run: ruff check . --output-format=github

  format:
    name: Formatage (Black)
    runs-on: ubuntu-latest

    steps:
    - name: Checkout du code
      uses: actions/checkout@v4

    - name: Configuration de Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'

    - name: Installation de Black
      run: |
        python -m pip install --upgrade pip
        pip install black

    - name: V√©rifier le formatage avec Black
      run: black --check --diff .

  type-check:
    name: Type Checking (mypy)
    runs-on: ubuntu-latest

    steps:
    - name: Checkout du code
      uses: actions/checkout@v4

    - name: Configuration de Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'

    - name: Installation des d√©pendances
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install mypy

    - name: Lancer mypy
      run: mypy . --install-types --non-interactive || true

  quality-summary:
    name: R√©sum√© qualit√©
    runs-on: ubuntu-latest
    needs: [lint, format, type-check]
    if: always()

    steps:
    - name: V√©rifier les r√©sultats
      run: |
        echo "üìä V√©rifications de qualit√© termin√©es"
        echo "- Linting (Ruff): ${{ needs.lint.result }}"
        echo "- Formatage (Black): ${{ needs.format.result }}"
        echo "- Type checking (mypy): ${{ needs.type-check.result }}"
